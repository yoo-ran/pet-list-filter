<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        #container {
            background-color: #ccc;
            width: 90%;
            height: 100vh;
            margin: 0 auto;
        }

        .box{
            background-color: yellow;
            width: 10%;
            height: 10vh;
        }

        p{
            background-color: red;
        }
    </style>
</head>
<body>
    <button type='button' class='species' data-species="" onclick='categorySearch(event)'>All</button>
    <button type='button' class='species' data-species="cat" onclick='categorySearch(event)'>Cat</button>
    <button type='button' class='species' data-species="dog" onclick='categorySearch(event)'>Dog</button>
    <button type='button' class='species' data-species="fish" onclick='categorySearch(event)'>Fish</button>
    <!-- <input type="checkbox" class='gender all' value='cat' data-gender="" onclick='test(event)'> All</input>
    <input type="checkbox" class='gender male' value='dog' data-gender="male" onclick='test(event)'> Male</input>
    <input type="checkbox" class='gender female' value='fish' data-gender="female" onclick='test(event)'> Female</input>
 -->

    <input type="text" onkeyup='search(event)' id='search' placeholder='search'>
    <button id='ascending' onclick='ascending(event)' data-sort="ascending">A-Z</button>
    <hr>
    <button id='clear' onclick='clear()'>Clear</button>

    <div id='container'>
    </div>


    <script>
        let speciesSession = JSON.parse(sessionStorage.getItem("species"))
        let originalObjSession = JSON.parse(sessionStorage.getItem("originalObj"))
        
        const obj = [
            {"fname":"Yooran", "lname":"Kim", "num":10, "species":"cat"},
            {"fname":"Mike", "lname":"Lee", "num":20,"species":"dog"},
            {"fname":"aa", "lname":"bb", "num":30,"species":"dog"},
            {"fname":"Barry", "lname":"Choi", "num":40,"species":"fish"}
        ]

        
        const load = () =>{
            reset()
            let sortedObjSession = JSON.parse(sessionStorage.getItem("sortedObj"))
            if(speciesSession==null || speciesSession==""){
                if(sortedObjSession==null || sortedObjSession==""){
                    originalObjSession.forEach(element => {
                        createCard(element)
                    })
                }else{
                    sortedObjSession.forEach(element => {
                        createCard(element)
                    })
                }
            }else{
                if(sortedObjSession==null || sortedObjSession==""){
                    originalObjSession.forEach(element => {
                        if(speciesSession.includes(element.species)){
                            createCard(element)
                        }
                    }); 
                }else {
                    sortedObjSession.forEach(element => {
                        if(speciesSession.includes(element.species)){
                            createCard(element)
                        }
                    })
                }
                
            }
        }

        const createCard = (item) => {
            let box = document.createElement("div");
            let p = document.createElement("p")
            let span = document.createElement("span")

            p.innerText = item.fname
            span.innerText= item.species

            // box추가
            box.className = "box"
            box.append(p,span)
            document.querySelector("#container").append(box)
        }

        const setSessionStorage = (key, value) => {
            sessionStorage.setItem(key,JSON.stringify(value))
        }

        const reset = () => {
            document.querySelector("#container").innerHTML = ""
        }

        const clear = () => {
            sessionStorage.removeItem("species")
            sessionStorage.removeItem("sortedObj")
            load()
        }


        const categorySearch = (e) =>{
            let clikedSpecies = e.target.dataset.species
            // If there is data in session storage
            if(speciesSession!=null ){
                // When user clidked "All"
                if(clikedSpecies==""){
                    speciesSession=[]
                    document.querySelectorAll(".species") .forEach(element => {
                        speciesSession.push(element.dataset.species)
                    });
                    speciesSession.shift()
                    setSessionStorage("species",speciesSession)
                }else{
                    // If there is no species in the session storage as same as species that user slicked
                    // It means new species should be added
                    if(!speciesSession.includes(clikedSpecies)){
                        speciesSession.push(clikedSpecies)
                        setSessionStorage("species",speciesSession)
                    
                    // Remove category from session storage
                    // If there is already species in session storage 
                    // That category should be removed from session storage
                    }else{
                        speciesSession = speciesSession.filter(species => {
                            return species != clikedSpecies
                        })
                        
                        setSessionStorage("species",speciesSession)
                    }
                }
            // If there is no data in session storage
            }else{
                // Make new array adding species value that user clicked
                speciesSession = [clikedSpecies]
                setSessionStorage("species",speciesSession)
            }

            load();

            // 삭제하자마다 사라지게
        }

        const search = (e) => {
            reset()
            let inputValue = e.target.value.toUpperCase()
            obj.forEach(item => {
                let petName = item.fname.toUpperCase()
                if(petName.indexOf(inputValue)>-1){
                   createCard(item)
                }
            });
        }
        // 

        const ascending = (e) => {
            console.log(e.target.dataset.sort);
            switch (e.target.dataset.sort) {
                case "ascending":
                    ascendingSort(obj)
                    e.target.dataset.sort = "descending";
                    e.target.innerText = "Z-A"

                break;
                case "descending":
                    descendingSort(obj)
                    e.target.dataset.sort = "ascending";
                    e.target.innerText = "A-Z"
                break;
            }
            load()
        }

        const ascendingSort = (object) =>{
                object.sort((a,b) =>{
                    // Regardless of letter case
                    const nameA = (a.fname).toUpperCase();
                    const nameB = (b.fname).toUpperCase();

                    if(nameA > nameB) return 1;
                    if(nameA < nameB) return -1;
                    if(nameA === nameB) return 0;
                })
            setSessionStorage("sortedObj", object)
        }

        const descendingSort = (object) =>{
                object.sort((a,b) =>{
                    // Regardless of letter case
                    const nameA = (a.fname).toUpperCase();
                    const nameB = (b.fname).toUpperCase();

                    if(nameA < nameB) return 1;
                    if(nameA > nameB) return -1;
                    if(nameA === nameB) return 0;
                })
            setSessionStorage("sortedObj", object)
        }
        
        
        setSessionStorage("originalObj", obj)
        window.addEventListener("load", load)
        document.querySelector("#clear").addEventListener("click",clear)

    </script>
</body>
</html>