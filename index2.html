<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        #container {
            background-color: #ccc;
            width: 90%;
            height: 100vh;
            margin: 0 auto;
        }

        .box{
            background-color: yellow;
            width: 10%;
            height: 10vh;
        }

        p{
            background-color: red;
        }
    </style>
</head>
<body>
    <button type='button' class='species' data-species="" onclick='test(event)'>All</button>
    <button type='button' class='species' data-species="cat" onclick='test(event)'>Cat</button>
    <button type='button' class='species' data-species="dog" onclick='test(event)'>Dog</button>
    <button type='button' class='species' data-species="fish" onclick='test(event)'>Fish</button>
    <!-- <input type="checkbox" class='gender all' value='cat' data-gender="" onclick='test(event)'> All</input>
    <input type="checkbox" class='gender male' value='dog' data-gender="male" onclick='test(event)'> Male</input>
    <input type="checkbox" class='gender female' value='fish' data-gender="female" onclick='test(event)'> Female</input>
 -->

    <hr>
    <button id='clear'>Clear</button>

    <div id='container'>
    </div>


    <script>
        let speciesSession = JSON.parse(sessionStorage.getItem("species"))

         const obj = [
            {"fname":"Yooran", "lname":"Kim", "num":10, "species":"cat"},
            {"fname":"Mike", "lname":"Lee", "num":20,"species":"dog"},
            {"fname":"aa", "lname":"bb", "num":30,"species":"dog"},
            {"fname":"Barry", "lname":"Choi", "num":40,"species":"fish"}
        ]
        
        const load = () =>{
            reset()
            if(speciesSession==null || speciesSession==""){
                obj.forEach(element => {
                        createCard(element)
                    });
            }else{
                obj.forEach(element => {
                        if(speciesSession.includes(element.species)){
                            createCard(element)
                        }
                }); 
            }
        }

        const createCard = (item) => {
            let box = document.createElement("div");
            let p = document.createElement("p")
            let span = document.createElement("span")

            p.innerText = item.fname
            span.innerText= item.species

            // box추가
            box.className = "box"
            box.append(p,span)
            document.querySelector("#container").append(box)
        }

        const setSessionStorage = (key, value) => {
            sessionStorage.setItem(key,JSON.stringify(value))
        }

        const reset = () => {
            document.querySelector("#container").innerHTML = ""
        }

        const clear = () => {
            sessionStorage.removeItem("species")
            load()
            console.log("clear");
        }


        const test = (e) =>{
            let clikedSpecies = e.target.dataset.species
            // If there is data in session storage
            if(speciesSession!=null ){
                // When user clidked "All"
                if(clikedSpecies==""){
                    speciesSession=[]
                    document.querySelectorAll(".species") .forEach(element => {
                        console.log(element.dataset.species);
                        speciesSession.push(element.dataset.species)
                    });
                    speciesSession.shift()
                    setSessionStorage("species",speciesSession)
                }else{
                    // If there is no species in the session storage as same as species that user slicked
                    // It means new species should be added
                    if(!speciesSession.includes(clikedSpecies)){
                        speciesSession.push(clikedSpecies)
                        setSessionStorage("species",speciesSession)
                    
                    // If there is already species in session storage 
                    // That category should be removed from session storage
                    }else{
                        let removeSpecies = speciesSession.filter( species => {
                            return species != clikedSpecies
                        })
                        setSessionStorage("species",removeSpecies)
                    }
                }
            // If there is no data in session storage
            }else{
                // Make new array adding species value that user clicked
                speciesSession = [clikedSpecies]
                setSessionStorage("species",speciesSession)
            }
            load()

            // 삭제하자마다 사라지게
        }
        

        window.addEventListener("load", load)
        document.querySelector("#clear").addEventListener("click",clear)

    </script>
</body>
</html>